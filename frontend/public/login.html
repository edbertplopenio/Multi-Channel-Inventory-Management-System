<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Character encoding and viewport for responsive design -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Link to external CSS file for custom styles -->
    <link rel="stylesheet" href="styles/login.css" />

    <!-- Link to Bootstrap 5 CSS for styling components -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <!-- SweetAlert2 CSS for modal styling -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />

    <!-- Page title -->
    <title>Login</title>
  </head>
  <body>
    <div class="wrapper">
      <div class="container main">
        <div class="row">
          <div class="col-md-6 side-image">
            <img src="images/white.png" alt="" />
            <div class="text"></div>
          </div>

          <div class="col-md-6 right">
            <div class="input-box">
              <header>Welcome Back!</header>
              <form id="loginForm">
                <div class="input-field">
                  <input
                    type="text"
                    class="input"
                    id="email"
                    name="email"
                    required
                    autocomplete="off"
                    placeholder=" "
                  />
                  <label for="email">Email</label>
                </div>

                <div class="input-field">
                  <input
                    type="password"
                    class="input"
                    id="pass"
                    name="pass"
                    required
                    placeholder=" "
                  />
                  <label for="pass">Password</label>
                </div>

                <div class="input-field">
                  <input type="submit" class="submit" value="Login" />
                </div>
              </form>
              <div class="signin">
                <span
                  >Forgot password?
                  <a href="#" id="resetPasswordLink">Reset</a></span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

    <script>
      // Handle form submission via AJAX
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          var email = document.getElementById("email").value;
          var pass = document.getElementById("pass").value;

          var formData = new FormData();
          formData.append("email", email);
          formData.append("pass", pass);

          fetch("../../backend/views/login.php", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "error") {
                // Show SweetAlert error message
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: data.message,
                });
              } else if (data.status === "success") {
                // Redirect if login is successful
                window.location.href = data.redirect;
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
    </script>

    <!-- Include SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

    <script>
      document
        .getElementById("resetPasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Prevent the default link behavior

          // Show SweetAlert modal
          Swal.fire({
            title: "Reset Password",
            text: "Please enter your email address to receive a password reset link.",
            input: "email", // Input field type (email)
            inputPlaceholder: "Enter your email address",
            showCancelButton: true,
            confirmButtonText: "Send Reset Link",
            cancelButtonText: "Cancel",
            inputValidator: (email) => {
              if (!email) {
                return "Please enter your email address";
              }
              // Simple regex for email format validation
              const emailRegex =
                /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
              if (!emailRegex.test(email)) {
                return "Please enter a valid email address";
              }
            },
            preConfirm: (email) => {
              // Ensure the email field is valid and not empty
              return email ? email : false;
            },
          }).then((result) => {
            if (result.isConfirmed) {
              const email = result.value;
              // Make AJAX request to the backend to process the password reset
              sendResetPasswordRequest(email);
            }
          });
        });

      function sendResetPasswordRequest(email) {
        const xhr = new XMLHttpRequest();
        xhr.open(
          "POST",
          "../../backend/controllers/send-password-reset.php",
          true
        );
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded"
        );

        xhr.onload = function () {
          // Make sure to handle valid JSON response and status
          try {
            const response = JSON.parse(xhr.responseText);
            if (xhr.status === 200) {
              if (response.status === "success") {
                Swal.fire("Success!", response.message, "success");
              } else {
                Swal.fire("Error!", response.message, "error");
              }
            } else {
              Swal.fire(
                "Error!",
                "There was an issue with the request.",
                "error"
              );
            }
          } catch (error) {
            Swal.fire(
              "Error!",
              "Failed to process the response. Please try again later.",
              "error"
            );
          }
        };

        xhr.onerror = function () {
          Swal.fire(
            "Error!",
            "There was a network issue. Please try again later.",
            "error"
          );
        };

        xhr.send("email=" + encodeURIComponent(email));
      }
    </script>
  </body>
</html>

<!-- Styles for the login page -->
<style>
  /* Importing Poppins font from Google Fonts */
  @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap");

  * {
    font-family: 'Times New Roman', Times, serif;
  }

  header {
  font-size: 25px;
  font-family: 'Times New Roman', Times, serif;
}


  .wrapper {
    background: #ececec; /* Light background color for the wrapper */
    padding: 0 20px 0 20px; /* Padding for spacing */
  }

  .main {
    display: flex;
    justify-content: center; /* Centers the main container horizontally */
    align-items: center; /* Centers the main container vertically */
    min-height: 100vh; /* Full viewport height */
  }

  .side-image {
    background-image: url("../public/images/loginside.png"); /* Background image for the left section */
    background-position: center;
    background-size: cover; /* Cover the entire section */
    background-repeat: no-repeat;
    border-radius: 10px 0 0 10px; /* Rounded left corners */
    position: relative;
  }

  .row {
    width: 900px; /* Width of the row */
    height: 550px; /* Height of the row */
    border-radius: 10px; /* Rounded corners */
    background: #fff; /* White background */
    padding: 0px;
    box-shadow: 5px 5px 10px 1px rgba(0, 0, 0, 0.2); /* Soft shadow effect */
  }

  .text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(
      -50%,
      -50%
    ); /* Center the text vertically and horizontally */
  }

  .text p {
    color: #fff;
    font-size: 20px;
  }

  i {
    font-weight: 400;
    font-size: 15px;
  }

  .right {
    display: flex;
    justify-content: center; /* Center the right section */
    align-items: center; /* Center the right section vertically */
    position: relative;
  }

  .input-box {
    width: 330px; /* Width of the input box */
    box-sizing: border-box;
  }

  img {
    width: 35px;
    position: absolute;
    top: 30px;
    left: 30px;
  }

  .input-box header {
    font-weight: 700;
    text-align: center;
    margin-bottom: 45px;
  }

  .input-field {
    display: flex;
    flex-direction: column;
    position: relative;
    padding: 0 10px 0 10px;
  }

  .input {
    height: 45px;
    width: 100%; /* Full width */
    background: transparent;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    outline: none;
    margin-bottom: 20px;
    color: #40414a;
  }

  .input-box .input-field label {
    position: absolute;
    top: 10px;
    left: 10px;
    pointer-events: none; /* Prevents interaction with the label */
    transition: 0.5s; /* Smooth transition for label movement */
  }

  .input-field input:focus ~ label,
  .input-field input:not(:placeholder-shown) ~ label {
    top: -10px; /* Move label above the input when focused or autofilled */
    font-size: 13px; /* Smaller font size */
  }

  .input-field input:valid ~ label,
  .input-field input:focus ~ label {
    top: -10px; /* Move label for valid input */
    font-size: 13px;
    color: #3CAE85; /* Change label color on valid input */
  }

  .input-field .input:focus,
  .input-field .input:valid {
    border-bottom: 1px solid #3CAE85; /* Highlight border when focused or valid */
  }

  .submit {
    border: none;
    outline: none;
    height: 45px;
    background: #ececec;
    border-radius: 5px;
    transition: 0.4s; /* Smooth transition effect on hover */
  }

  .submit:hover {
    background: #3CAE85; /* Change background color on hover */
    color: #fff; /* Change text color on hover */
  }

  .signin {
    text-align: center;
    font-size: small;
    margin-top: 25px;
  }

  span a {
    text-decoration: none; /* Remove underline */
    font-weight: 700;
    color: #000;
    transition: 0.5s; /* Smooth transition effect */
  }

  span a:hover {
    text-decoration: underline; /* Underline text on hover */
    color: #000;
  }

  /* Media query for responsive design (small screens) */
  @media only screen and (max-width: 768px) {
    .side-image {
      border-radius: 10px 10px 0 0; /* Round both top corners for small screens */
    }
    img {
      width: 35px;
      position: absolute;
      top: 20px;
      left: 47%;
    }
    .text {
      position: absolute;
      top: 70%;
      text-align: center;
    }
    .text p,
    i {
      font-size: 16px;
    }
    .row {
      max-width: 420px; /* Limit width for small screens */
      width: 100%;
    }
  }
</style>
